---
layout: post
title: The Sad State of Wi-Fi APIs in Apple Platforms
tag:
- wifi
- apple
- api
- wwdc
- wwdr
---

<p>It’s <a href="https://developer.apple.com/wwdc/">WWDC</a> prediction season again. Spring break for Nerds will soon descend on San Jose with it’s sessions all day, parties all night schedule. Rumors and speculation fly along with wish lists for new features that might be announced in the big keynote. Legions of fans sit huddled over glowing screens watching the video and refreshing news sites to see what other people watching the video are saying about the video.</p><h4>My Wishlist is Short</h4><p>I only ever have one wish for WWDC: <strong>a single, comprehensive Wi-Fi API on all Apple platforms which can be used for apps released in the App Stores</strong>.</p><p>Seems simple enough, we have had <a href="https://developer.apple.com/library/mac/documentation/Networking/Reference/CoreWLANFrameworkRef/index.html">CoreWLAN</a> on macOS since <a href="http://www.apple.com/shop/product/MC573Z/A/mac-os-x-106-snow-leopard">10.6</a>. In fact, your truly got to introduce the feature at WWDC [citation needed] after working with World Wide Developer Relations organization and spending a lot of time persuading my colleges to just let it happen already.</p><p>Just one small wrinkle; there was a question about <em>which</em> Wi-Fi API was going to be published. That WWDC video isn’t available, I presume, because the API that I got up on stage and presented, wasn’t CoreWLAN, and neither the placeholder or the eventual incumbent were my first choice. But no matter, there was an API, it did everything that was needed and it replaced the reverse engineered <a href="http://www.macstumbler.com/Apple80211.h">Apple80211.h</a> file everyone had been using up to that point.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/460/1*FumEQDdB_Z_EsAlBTk_chg.jpeg" /><figcaption>We’re done here, right?</figcaption></figure><h4>Let’s Roll Some Wi-Fi Apps!</h4><p>As happy as I was to help publish the Wi-Fi API and get it introduced it to the world, my real motivation was to update iStumbler. It took a little while after the release of SnowLeopard until I was able to get permission to ship <a href="https://istumbler.net/archive/release99/">iStumbler Release 99</a> in February 2010.</p><p>Despite my selfish motivation, I am very proud to have enabled a number of other Wi-Fi apps, which eventually made their way to, the Mac App store. Even if one of them is an <a href="https://itunes.apple.com/us/app/wifi-manager/id483772322?mt=12">unbelievable facile</a> compile and submit of the example code for CoreWLAN:</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*cXnkMrtRyKMIfQJOae3zMA.png" /><figcaption>Something is missing…</figcaption></figure><h4>But then iOS</h4><p>The development of iOS and iPhone was famously segregated from the existing Mac and OS X development. As such, they did not share their Wi-Fi Client stack (the user-space software which keeps the list of preferred networks and manages the automatic-join process) until fairly recently, after the teams where eventually merged in Apple’s <a href="https://www.youtube.com/watch?v=tVq1wgIN62E">Deforistallizaion</a> process.</p><p>The iOS Wi-Fi team decided early that they were not going to offer a public API and have been doggedly hardening each release to prevent access to apps who try to use it, even on Jailbroken devices. My understanding is that it’s considered a privacy risk, as a Wi-Fi scan list can be submitted to a number of online services to determine the user’s location (which is exactly what CoreLocation does). If only there were some way to notify the user that an App wanted access to a hardware feature with some privacy or security implication…</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*gFXC-lcHAPbGtCECHg3MLQ.png" /><figcaption>I just can’t think of a way to get affirmative consent from a user…</figcaption></figure><h4>Enter Sandbox</h4><p>Much has been written about the limitations of the App Sandbox and the Mac App store over the past few years, despite the (relatively modest) amount of work involved, I’d be very happy to have iStumbler in the Mac App store. Sadly, I missed the window to submit it before the App Sandbox became a requirement, which as you can see from the <a href="https://developer.apple.com/library/mac/documentation/Security/Conceptual/AppSandboxDesignGuide/DesigningYourSandbox/DesigningYourSandbox.html">App Sandbox Design Guide</a> precludes using CoreWLAN:</p><blockquote>With App Sandbox, your app cannot modify the system’s network configuration (whether with the System Configuration framework, the CoreWLAN framework, or other similar APIs) because doing so requires administrator privileges.</blockquote><p>Which means iStumbler stuck outside of the App Store and it’s throngs of paying customers, and instead has to rely on discovery and sales via my <a href="https://istumbler.net/store.html">web site</a> (hint-hint). But it’s worse for the developers who have Wi-Fi apps already on the store: they can’t be updated with new features, because that would require sandboxing. Which isn’t allowed.</p><p>This creates a tenuous situation for people trying to make a living writing applications which utilize Wi-Fi. You can imagine my dismay when 10.11 shipped and iStumbler started emitting this warning:</p><blockquote>airportd[#]: WARNING: iStumbler (#) is not entitled for com.apple.wifi.scan, temporarily allowing request with background priority — — all entitlement requirements will be strictly enforced in a future release</blockquote><p>Thankfully the warning is gone from 10.12, but for a year or so there it looked like we were headed deep into Kafka territory: A Public Wi-Fi API exists, but you can’t use it outside of the sandbox without entitlements and we don’t allow <a href="http://stackoverflow.com/questions/37529193/what-is-the-entitlement-for-a-mac-app-to-use-corewlan-to-access-wi-fi-in-the-san">those entitlements</a> to be used for Developer ID or Mac App Store apps.</p><h4>But Who Cares? Really?</h4><p>You really should. If you’ve ever stared at your screen waiting for something to load, spent an evening debugging a family member’s broken Wi-Fi connection, had to call a nerdy family member over to fix a broken Wi-Fi connection or generally wondered “how does this magic technology which brings me kitten photos by the exabyte work?” then you have some skin in the game.</p><p>Access to the internal workings of your computer might break the feeling of magic for some, and there are things which you don’t need or want to see, but we all care very much about our connection to the rest of humanity and having the tools to make sure that our Wi-Fi is connected, performing well and reliably is critically important to our sense of well-being in a more and more interconnected world.</p><h4>A Modest Proposal</h4><p>I’m going to preface this by admitting that it’s a big ask to get Apple to change their course on this. User privacy protections, concerns over battery usage, the need for additional testing to make sure that even aggressive use of the public APIs don’t degrade system performance unacceptably all take time and political will to make happen.</p><p><strong>Apple should publish a single, well documented and comprehensive Wi-Fi API which works on all Apple Devices which can be deployed to the App Stores</strong>. Let the user know that an app wants to use Wi-Fi, and let them decide if they want to enable Wi-Fi access in the foreground or background in the same manner as location services, the address book or camera.</p><p>It might seem like a niche feature, <strong>but network connectivity problems are difficult problems to diagnose and resolve.</strong> Hard problems require a robust and ever changing set tools to collect information and improve the user experience.</p><p>Pretty please?</p><img src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=943893be17a2" width="1" height="1" alt="">
