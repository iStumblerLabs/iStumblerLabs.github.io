---
layout: post
title: Wi-Fi’s Service Discovery Problem
tag:
- wifi
- service-discovery
- internet
---

<p>Picture yourself in a conference room; you are a visitor here, sitting in front of a laptop looking at a document that you need to send to your host, who works here. You host needs to review the document before sending it on for approvals. There is a lot of money hanging on these approvals and you are anxious to get the document reviewed.</p><p>It’s not a huge file, but it’s not small either, too big for email, let’s say a whopping 100 Mb. And it just so happens that the internet connection in this conference room is slow, very slow something like 100 Kb/s, even if you could upload the file to a sharing site your host will have to download it again, taking twice as long…</p><p>The good news? Both your laptop and your hosts are equipped with the latest Wi-Fi and Bluetooth radios. Bluetooth won’t help you much, since it’s not fast enough to transfer the file in a reasonable amount of time, but if you have recent laptops you should be able to get more than a gigabit per second using the Wi-Fi Radios.</p><h4><strong>Bonne Chance!</strong></h4><p>Assuming that you and your host have some way to share files locally, and that both the client and server are on the same network, all we need to connect is to figure out what network addresses to use. Thankfully there are standards for doing this. And the beautiful thing about standards is that there are so many to choose from:</p><ul><li><a href="https://en.wikipedia.org/wiki/Bonjour_%28software%29">Bonjour</a>, based on the <a href="https://www.ietf.org">IETF</a> <a href="https://tools.ietf.org/html/rfc6762">mDNS</a> and <a href="https://tools.ietf.org/html/rfc6763">DNS-SD</a> RFCs, promoted and branded by Apple</li><li><a href="https://en.wikipedia.org/wiki/Universal_Plug_and_Play">UPnP</a>, based on, uh, Microsoft stuff, I guess, promoted by the <a href="http://openconnectivity.org">Open Connectivity Foundation</a> (totally not a standards group)</li><li><a href="https://en.wikipedia.org/wiki/Service_Location_Protocol">SLP</a> an older IETF RFCs, now considered more or less obsolete</li></ul><p>Here we have our first problem: Windows and MacOS implement two different protocols, and neither implements the other. Android implements both natively but doesn’t provide it’s own browser or basic set of tools so you’ll need to find an app to complete our proposed file transfer.</p><h4>Administrative Denials of Service</h4><p>Provided you’re lucky enough to have two devices that <em>can</em> discover each other, they then have to be on the same network to use any of the service discovery protocols we’ve discussed so far. More specifically, they need to be in the same <a href="https://en.wikipedia.org/wiki/Broadcast_domain">broadcast domain</a> so that service discovery messages can be heard by other devices. Broadcast domains typically extend across an entire Wi-Fi <a href="https://en.wikipedia.org/wiki/Service_set_(802.11_network)">SSID</a> or IP <a href="https://en.wikipedia.org/wiki/Subnetwork">Subnet</a>. However most business guest and internal Wi-Fi networks are “separate but equal” networks, with guest not allowed to connect to the internal network.</p><p>Even if both laptops join the guest network many enterprise Wi-Fi networks provide a “<a href="http://security.stackexchange.com/questions/16751/wireless-client-isolation-how-does-it-work-and-can-it-be-bypassed">client isolation</a>” or “<a href="http://superuser.com/questions/730288/why-do-some-wifi-routers-block-multicast-packets-going-from-wired-to-wireless">multicast filtering</a>” mode which prevents clients on the network for talking to each other, which prevents service discovery from happening.</p><h4>Screw It, We’ll Go Direct</h4><p>Clearly this is a bad situation: two laptops sitting right next to each other on a table which have an array of communications tools but can’t talk to each other, even if they are compatible, due to the network configuration. Unfortunately it’s not uncommon, so the <a href="https://en.wikipedia.org/wiki/Wi-Fi_Alliance">Wi-Fi Alliance</a> (WFA) got together and developed the <a href="https://en.wikipedia.org/wiki/Wi-Fi_Direct">Wi-Fi Direct</a> specification which allows Wi-Fi Devices to connect to each other without the Access Point getting in the way.</p><p>The earliest Wi-Fi Direct devices shipped in 2011. Apple, at about the same time, developed <a href="https://en.wikipedia.org/wiki/AirDrop">AirDrop</a> and released it in <a href="https://en.wikipedia.org/wiki/Mac_OS_X_Lion">MacOS 10.7</a>. So, once again we have a platform divide: MacOS devices can connect directly (but not with iOS, for a few more years) but AirDrop doesn’t interoperate with Wi-Fi Direct and now we have Apple on one side and Everybody Else on the other. Again.</p><h4>Now What?</h4><p>Without a cross-platform story Wi-Fi Direct has had lackluster success, and the WFA has not taken the time to specify the IP networking environment for Wi-Fi that would make existing IP service discovery protocols work. They have added a new and exciting twist with <a href="http://www.wi-fi.org/discover-wi-fi/wi-fi-aware">Wi-Fi Aware</a> which overlaps with Wi-Fi Direct in scope and functionality, and allows for pre-association advertising and discovery of services (which Wi-Fi Direct also supports) and then connection to an Infrastructure, IBSS, P2P or Mesh Wi-Fi network on which the application can do further service discovery to get an IP address and finally connect for application layer traffic to flow.</p><p>While it’s not unusual for WFA to publish a specification like this, the situation is clearly fraught. While the industry players shuffle for dominance in the service discovery and connectivity market, users are left with the simple and apparently insoluble problem: “Why can’t I connect to the device right next to me?”</p><img src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=137be4af1b72" width="1" height="1" alt="">
